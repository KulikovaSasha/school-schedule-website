
{% extends "base.html" %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/schedule-editor.css') }}">
{% endblock %}

{% block content %}
<div class="container">
    <div class="schedule-header">
        <h2>‚úè –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: {{ schedule.title }}</h2>
        <div class="schedule-actions">
            <button id="save-schedule" class="btn btn-success">
                <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
            </button>
            <a href="{{ url_for('main.view_schedule', schedule_id=schedule.id) }}" class="btn btn-primary">
                <i class="fas fa-eye"></i> –ü—Ä–æ—Å–º–æ—Ç—Ä
            </a>
            <a href="{{ url_for('main.dashboard') }}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥
            </a>
        </div>
    </div>

    <div class="schedule-info">
        <div class="info-item">
            <strong>–î–Ω–∏ –Ω–µ–¥–µ–ª–∏:</strong> {{ days|join(', ') }}
        </div>
        <div class="info-item">
            <strong>–£—Ä–æ–∫–æ–≤ –≤ –¥–µ–Ω—å:</strong> {{ schedule.lessons_per_day }}
        </div>
        <div class="info-item">
            <strong>–ü–µ—Ä–≤—ã–π —É—Ä–æ–∫:</strong> {{ schedule.start_time }}
        </div>
        <div class="info-item">
            <strong>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —É—Ä–æ–∫–∞:</strong> {{ schedule.lesson_duration }} –º–∏–Ω—É—Ç
        </div>
    </div>

    <div class="bulk-actions">
        <h4>–ú–∞—Å—Å–æ–≤—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:</h4>
        <div class="bulk-controls">
            <select id="bulk-font-selector" class="form-control">
                <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —à—Ä–∏—Ñ—Ç --</option>
                {% for font in available_fonts %}
                <option value="{{ font.value }}">{{ font.name }}</option>
                {% endfor %}
            </select>
            <input type="color" id="bulk-color-picker" value="#B3E5FC" class="form-control">
            <button onclick="applyFontToAll()" class="btn btn-outline">
                <i class="fas fa-font"></i> –ü—Ä–∏–º–µ–Ω–∏—Ç—å —à—Ä–∏—Ñ—Ç
            </button>
            <button onclick="applyColorToAll()" class="btn btn-outline">
                <i class="fas fa-palette"></i> –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ü–≤–µ—Ç
            </button>
        </div>
    </div>

    <div class="schedule-editor-container">
        <table class="schedule-table">
            <thead>
                <tr>
                    <th class="time-header">–í—Ä–µ–º—è</th>
                    {% for day in days %}
                    <th class="day-header">{{ day }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for lesson_index in range(schedule.lessons_per_day) %}
                <tr>
                    <td class="time-cell">
                        <div class="time-display">
                            {{ lesson_times[lesson_index]['start'] }} - {{ lesson_times[lesson_index]['end'] }}
                        </div>
                    </td>

                    {% for day_index in range(days|length) %}
                    {% set lesson_key = day_index ~ '_' ~ lesson_index %}
                    {% set lesson = lessons[lesson_key] if lesson_key in lessons else None %}

                    <td class="lesson-cell"
                        data-day="{{ day_index }}"
                        data-lesson="{{ lesson_index }}"
                        style="background-color: {{ lesson.color if lesson and lesson.color else '#FFFFFF' }};">

                        <div class="lesson-controls">
                            <input type="text"
                                   class="subject-input form-control"
                                   placeholder="–ü—Ä–µ–¥–º–µ—Ç"
                                   value="{{ lesson.subject_name if lesson else '' }}"
                                   style="font-family: {{ lesson.font_family if lesson and lesson.font_family else 'Arial' }};">

                            <div class="link-section">
                                <input type="url"
                                       class="lesson-link-input form-control"
                                       placeholder="https://meet.google.com/abc-def-ghi"
                                       value="{{ lesson.lesson_link if lesson else '' }}">
                                <input type="text"
                                       class="link-text-input form-control"
                                       placeholder="–¢–µ–∫—Å—Ç —Å—Å—ã–ª–∫–∏"
                                       value="{{ lesson.link_text if lesson and lesson.link_text else '–ü–µ—Ä–µ–π—Ç–∏ –∫ —É—Ä–æ–∫—É' }}">
                            </div>

                            <div class="style-controls">
                                <select class="font-selector form-control">
                                    {% for font in available_fonts %}
                                    <option value="{{ font.value }}"
                                            {% if lesson and lesson.font_family == font.value %}selected{% endif %}>
                                        {{ font.name }}
                                    </option>
                                    {% endfor %}
                                </select>

                                <div class="color-control">
                                    <input type="color"
                                           class="color-picker form-control"
                                           value="{{ lesson.color if lesson and lesson.color else '#B3E5FC' }}"
                                           list="colorPresets">
                                    <datalist id="colorPresets">
                                        <option value="#FFF9C4">–ñ–µ–ª—Ç—ã–π</option>
                                        <option value="#C8E6C9">–ó–µ–ª–µ–Ω—ã–π</option>
                                        <option value="#B3E5FC">–ì–æ–ª—É–±–æ–π</option>
                                        <option value="#E1BEE7">–§–∏–æ–ª–µ—Ç–æ–≤—ã–π</option>
                                        <option value="#FFE0B2">–û—Ä–∞–Ω–∂–µ–≤—ã–π</option>
                                        <option value="#FFCDD2">–†–æ–∑–æ–≤—ã–π</option>
                                        <option value="#D1C4E9">–°–∏—Ä–µ–Ω–µ–≤—ã–π</option>
                                    </datalist>
                                    <span class="color-label">–¶–≤–µ—Ç</span>
                                </div>
                            </div>
                        </div>
                    </td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<input type="hidden" id="schedule-id" value="{{ schedule.id }}">

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º -->
<div class="modal platform-modal" id="platformModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>üì± –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –¥–ª—è —É—Ä–æ–∫–æ–≤</h3>
            <button class="close-modal" onclick="closePlatformModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div class="platform-grid">
                <div class="platform-item" onclick="insertPlatformLink('zoom', 'Zoom')">
                    <i class="fas fa-video"></i>
                    <span>Zoom</span>
                </div>
                <div class="platform-item" onclick="insertPlatformLink('google_meet', 'Google Meet')">
                    <i class="fab fa-google"></i>
                    <span>Google Meet</span>
                </div>
                <div class="platform-item" onclick="insertPlatformLink('microsoft_teams', 'Microsoft Teams')">
                    <i class="fas fa-users"></i>
                    <span>Teams</span>
                </div>
                <div class="platform-item" onclick="insertPlatformLink('discord', 'Discord')">
                    <i class="fab fa-discord"></i>
                    <span>Discord</span>
                </div>
                <div class="platform-item" onclick="insertPlatformLink('skype', 'Skype')">
                    <i class="fab fa-skype"></i>
                    <span>Skype</span>
                </div>
                <div class="platform-item" onclick="insertPlatformLink('youtube', 'YouTube')">
                    <i class="fab fa-youtube"></i>
                    <span>YouTube</span>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/schedule-editor.js') }}"></script>
{% endblock %}

{% extends "base.html" %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/schedule-editor.css') }}">
{% endblock %}

{% block content %}
<div class="container">
    <div class="schedule-header">
        <h2>✏ Редактирование: {{ schedule.title }}</h2>
        <div class="schedule-actions">
            <button id="save-schedule" class="btn btn-success">
                <i class="fas fa-save"></i> Сохранить
            </button>
            <a href="{{ url_for('main.view_schedule', schedule_id=schedule.id) }}" class="btn btn-primary">
                <i class="fas fa-eye"></i> Просмотр
            </a>
            <a href="{{ url_for('main.dashboard') }}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Назад
            </a>
        </div>
    </div>

    <div class="schedule-info">
        <div class="info-item">
            <strong>Дни недели:</strong> {{ days|join(', ') }}
        </div>
        <div class="info-item">
            <strong>Уроков в день:</strong> {{ schedule.lessons_per_day }}
        </div>
        <div class="info-item">
            <strong>Первый урок:</strong> {{ schedule.start_time }}
        </div>
        <div class="info-item">
            <strong>Длительность урока:</strong> {{ schedule.lesson_duration }} минут
        </div>
    </div>

    <div class="bulk-actions">
        <h4>Массовые действия:</h4>
        <div class="bulk-controls">
            <select id="bulk-font-selector" class="form-control">
                <option value="">-- Выберите шрифт --</option>
                {% for font in available_fonts %}
                <option value="{{ font.value }}">{{ font.name }}</option>
                {% endfor %}
            </select>
            <input type="color" id="bulk-color-picker" value="#B3E5FC" class="form-control">
            <button onclick="applyFontToAll()" class="btn btn-outline">
                <i class="fas fa-font"></i> Применить шрифт
            </button>
            <button onclick="applyColorToAll()" class="btn btn-outline">
                <i class="fas fa-palette"></i> Применить цвет
            </button>
        </div>
    </div>

    <div class="schedule-editor-container">
        <table class="schedule-table">
            <thead>
                <tr>
                    <th class="time-header">Время</th>
                    {% for day in days %}
                    <th class="day-header">{{ day }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for lesson_index in range(schedule.lessons_per_day) %}
                <tr>
                    <td class="time-cell">
                        <div class="time-display">
                            {{ lesson_times[lesson_index]['start'] }} - {{ lesson_times[lesson_index]['end'] }}
                        </div>
                    </td>

                    {% for day_index in range(days|length) %}
                    {% set lesson_key = day_index ~ '_' ~ lesson_index %}
                    {% set lesson = lessons[lesson_key] if lesson_key in lessons else None %}

                    <td class="lesson-cell"
                        data-day="{{ day_index }}"
                        data-lesson="{{ lesson_index }}"
                        style="background-color: {{ lesson.color if lesson and lesson.color else '#FFFFFF' }};">

                        <div class="lesson-controls">
                            <input type="text"
                                   class="subject-input form-control"
                                   placeholder="Предмет"
                                   value="{{ lesson.subject_name if lesson else '' }}"
                                   style="font-family: {{ lesson.font_family if lesson and lesson.font_family else 'Arial' }};">

                            <div class="link-section">
                                <input type="url"
                                       class="lesson-link-input form-control"
                                       placeholder="https://meet.google.com/abc-def-ghi"
                                       value="{{ lesson.lesson_link if lesson else '' }}">
                                <input type="text"
                                       class="link-text-input form-control"
                                       placeholder="Текст ссылки"
                                       value="{{ lesson.link_text if lesson and lesson.link_text else 'Перейти к уроку' }}">
                            </div>

                            <div class="style-controls">
                                <select class="font-selector form-control">
                                    {% for font in available_fonts %}
                                    <option value="{{ font.value }}"
                                            {% if lesson and lesson.font_family == font.value %}selected{% endif %}>
                                        {{ font.name }}
                                    </option>
                                    {% endfor %}
                                </select>

                                <div class="color-control">
                                    <input type="color"
                                           class="color-picker form-control"
                                           value="{{ lesson.color if lesson and lesson.color else '#B3E5FC' }}"
                                           list="colorPresets">
                                    <datalist id="colorPresets">
                                        <option value="#FFF9C4">Желтый</option>
                                        <option value="#C8E6C9">Зеленый</option>
                                        <option value="#B3E5FC">Голубой</option>
                                        <option value="#E1BEE7">Фиолетовый</option>
                                        <option value="#FFE0B2">Оранжевый</option>
                                        <option value="#FFCDD2">Розовый</option>
                                        <option value="#D1C4E9">Сиреневый</option>
                                    </datalist>
                                    <span class="color-label">Цвет</span>
                                </div>
                            </div>
                        </div>
                    </td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<input type="hidden" id="schedule-id" value="{{ schedule.id }}">


{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/schedule-editor.js') }}"></script>
{% endblock %}